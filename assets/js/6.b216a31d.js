(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{210:function(n,t,e){n.exports=e.p+"assets/img/excuse_me.56587c02.png"},211:function(n,t,e){n.exports=e.p+"assets/img/qiguai.7f29f9cd.png"},212:function(n,t,e){n.exports=e.p+"assets/img/beautiful.723b129d.png"},247:function(n,t,e){"use strict";e.r(t);var o=[function(){var n=this,t=n.$createElement,o=n._self._c||t;return o("div",{staticClass:"content"},[o("h1",{attrs:{id:"位移枚举的使用与位掩码"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#位移枚举的使用与位掩码","aria-hidden":"true"}},[n._v("#")]),n._v(" 位移枚举的使用与位掩码")]),n._v(" "),o("h2",{attrs:{id:"前言"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[n._v("#")]),n._v(" 前言")]),n._v(" "),o("p",[n._v("我们在 Objective-C 代码里经常会看到这样的枚举，为什么要这么写？就写个枚举而已还整上位运算了？")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("typedef NS_OPTIONS(NSUInteger, UIControlState) {\n\n  UIControlStateNormal    = 0,\n\n  UIControlStateHighlighted = 1 << 0,         // used when UIControl isHighlighted is set\n\n  UIControlStateDisabled   = 1 << 1,\n\n  UIControlStateSelected   = 1 << 2,         // flag usable by app (see below)\n\n  UIControlStateFocused API_AVAILABLE(ios(9.0)) = 1 << 3, // Applicable only when the screen supports focus\n\n  UIControlStateApplication = 0x00FF0000,       // additional flags available for application use\n\n  UIControlStateReserved   = 0xFF000000        // flags reserved for internal framework use\n\n};\n")])])]),o("h2",{attrs:{id:"场景揣测"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#场景揣测","aria-hidden":"true"}},[n._v("#")]),n._v(" 场景揣测")]),n._v(" "),o("ul",[o("li",[o("p",[n._v("有1个 button")])]),n._v(" "),o("li",[o("p",[n._v("有一个事件枚举UIControlEvents，包含多个手势类型")])]),n._v(" "),o("li",[o("p",[n._v("有两个事件处理函数 touchUp 和 touchDown")])]),n._v(" "),o("li",[o("p",[n._v("给 button 添加事件处理函数，要求：")]),n._v(" "),o("ul",[o("li",[n._v("监听 UIControlEventTouchUpInside 绑定 touchUp 方法")]),n._v(" "),o("li",[n._v("监听 UIControlEventTouchDown 绑定 touchDown 方法")])])])]),n._v(" "),o("h3",{attrs:{id:"首先想到的方法"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#首先想到的方法","aria-hidden":"true"}},[n._v("#")]),n._v(" 首先想到的方法")]),n._v(" "),o("p",[n._v("注册两个事件呗")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("[btn addTarget:self action: @selector(touchUp) forControlEvents:UIControlEventTouchUpInside];\n\n[btn addTarget:self action: @selector(touchDown) forControlEvents:UIControlEventTouchDown];\n")])])]),o("h3",{attrs:{id:"apple-官方做法"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#apple-官方做法","aria-hidden":"true"}},[n._v("#")]),n._v(" Apple 官方做法")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("[btn addTarget:self action: @selector(touchUp) forControlEvents:UIControlEventTouchUpInside | UIControlEventTouchDown];\n")])])]),o("p",[o("img",{attrs:{src:e(210),alt:"excuse_me.png"}})]),n._v(" "),o("p",[o("strong",[n._v("为什么只用一行代码能注册两个事件？forControlEvents 明明只接收一个参数啊？")])]),n._v(" "),o("p",[o("strong",[n._v("后面的或运算什么鬼？")])]),n._v(" "),o("p",[n._v("点进去看看 UIControlEvents 其实是个枚举")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("typedef NS_OPTIONS(NSUInteger, UIControlEvents) {\n\n  UIControlEventTouchDown                     = 1 << 0,   // on all touch downs\n\n  UIControlEventTouchDownRepeat                  = 1 << 1,   // on multiple touchdowns (tap count > 1)\n\n  UIControlEventTouchDragInside                  = 1 << 2,\n\n  UIControlEventTouchDragOutside                 = 1 << 3,\n\n  UIControlEventTouchDragEnter                  = 1 << 4,\n\n  UIControlEventTouchDragExit                   = 1 << 5,\n\n  UIControlEventTouchUpInside                   = 1 << 6,\n\n  UIControlEventTouchUpOutside                  = 1 << 7,\n\n  UIControlEventTouchCancel                    = 1 << 8,\n\n\n\n  UIControlEventValueChanged                   = 1 << 12,   // sliders, etc.\n\n  UIControlEventPrimaryActionTriggered API_AVAILABLE(ios(9.0)) = 1 << 13,   // semantic action: for buttons, etc.\n\n\n\n  UIControlEventEditingDidBegin                  = 1 << 16,   // UITextField\n\n  UIControlEventEditingChanged                  = 1 << 17,\n\n  UIControlEventEditingDidEnd                   = 1 << 18,\n\n  UIControlEventEditingDidEndOnExit                = 1 << 19,   // 'return key' ending editing\n\n\n\n  UIControlEventAllTouchEvents                  = 0x00000FFF, // for touch events\n\n  UIControlEventAllEditingEvents                 = 0x000F0000, // for UITextField\n\n  UIControlEventApplicationReserved                = 0x0F000000, // range available for application use\n\n  UIControlEventSystemReserved                  = 0xF0000000, // range reserved for internal framework use\n\n  UIControlEventAllEvents                     = 0xFFFFFFFF\n\n};\n")])])]),o("p",[n._v("woc，这个枚举不简单，竟然还有位运算。")]),n._v(" "),o("p",[n._v("常规理解，枚举就是一堆常量，是固定的死值，它再是位运算，他也是死值，就算 1 << 2 = 4，这个 4 也是固定的。")]),n._v(" "),o("p",[n._v("回看上面给 button 添加事件的时候用到的 UIControlEvents 枚举，那里的或运算与枚举里的位运算肯定有某种关系")]),n._v(" "),o("p",[n._v("UIControlEventTouchUpInside(1 << 6) | UIControlEventTouchDown(1 << 0) 结果为：")]),n._v(" "),o("p",[n._v("1000000")]),n._v(" "),o("p",[n._v("0000001")]),n._v(" "),o("hr"),n._v(" "),o("p",[n._v("1000001")]),n._v(" "),o("p",[n._v("所以UIControlEvents最终接收到的值是 1000001")]),n._v(" "),o("p",[o("strong",[n._v("Q：那么怎么判定 1000001 既等于 1000000 有等于 1 成立呢？")])]),n._v(" "),o("p",[o("strong",[n._v("A：不用 = 号，而使用与运算 &")])]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("- (void)addTarget:(nullable id)target action:(SEL)action forControlEvents:(UIControlEvents)controlEvents {\n\n    if (controlEvents & UIControlEventTouchUpInside) {\n\n        // TouchUp 逻辑\n\n    }\n\n    if (controlEvents & UIControlEventTouchDown) {\n\n        // TouchDown 逻辑\n\n    }\n\n    ...\n\n}\n")])])]),o("p",[n._v("由于 1000001 是由 1000000 和 1 进行或运算得到的，所以")]),n._v(" "),o("p",[n._v("1000001 & 1000000 = 1 (true)")]),n._v(" "),o("p",[n._v("1 & 1000000 = 1000000 (true)")]),n._v(" "),o("p",[n._v("即上面两个 if 判断成立，能够注册UIControlEventTouchUpInside和UIControlEventTouchDown事件")]),n._v(" "),o("p",[o("strong",[n._v("什么？瞎传一个大值不就能与小指与运算成功了？")])]),n._v(" "),o("ol",[o("li",[n._v("瞎传枚举编译过不去，必须是指定枚举值")]),n._v(" "),o("li",[n._v("枚举值内都是向左位移运算的，全是 1 后面跟着数个0，不存在 11111 这种万能值（除非自己定义一个用来匹配所有值的万能值，如 UIControlEventAllEvents）")])]),n._v(" "),o("h3",{attrs:{id:"奇怪的知识-位掩码"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#奇怪的知识-位掩码","aria-hidden":"true"}},[n._v("#")]),n._v(" 奇怪的知识 - 位掩码")]),n._v(" "),o("blockquote",[o("p",[n._v("什么是”位掩码“。\n位掩码（BitMask），是”位（Bit）“和”掩码（Mask）“的组合词。”位“指代着二进制数据当中的二进制位，而”掩码“指的是一串用于与目标数据进行按位操作的二进制数字。组合起来，就是”用一串二进制数字（掩码）去操作另一串二进制数字“的意思。")])]),n._v(" "),o("p",[o("img",{attrs:{src:e(211),alt:""}})]),n._v(" "),o("p",[n._v("重新设计上面点击事件的栗子，定义一个关于权限的枚举")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("typedef enum {\n\n  roleA = 1 << 0, // 1（十进制 1）\n\n  roleB = 1 << 1, // 10（十进制 2）\n\n  roleC = 1 << 2, // 100（十进制 4）\n\n}AuthType;\n")])])]),o("h4",{attrs:{id:"常规方法"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#常规方法","aria-hidden":"true"}},[n._v("#")]),n._v(" 常规方法")]),n._v(" "),o("p",[n._v("给彦祖分配两个角色 roleA 和 roleC")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("NSMutableArray *auths = [NSMutableArray new];\n\n[auths addObject:@(roleA)];\n\n[auths addObject:@(roleC)];\n")])])]),o("p",[n._v("判断彦祖有哪些角色，并做相关操作")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v('[auths enumerateObjectsUsingBlock:^(id _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {\n\n    if ([obj isEqual: @(roleA)]) {\n\n      NSLog(@"给彦祖一个面具");\n\n    }\n\n    if ([obj isEqual: @(roleB)]) {\n\n      NSLog(@"给彦祖一把枪");\n\n    }\n\n    if ([obj isEqual: @(roleC)]) {\n\n      NSLog(@"给彦祖一个成龙");\n\n    }\n\n }];\n')])])]),o("h4",{attrs:{id:"位掩码方法"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#位掩码方法","aria-hidden":"true"}},[n._v("#")]),n._v(" 位掩码方法")]),n._v(" "),o("p",[n._v("给彦祖分配两个角色 roleA 和 roleB")]),n._v(" "),o("p",[n._v("通过或运算赋予值")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("NSInteger auth = roleA | roleC;\n")])])]),o("p",[n._v("判断彦祖有哪些角色，并做相关操作。")]),n._v(" "),o("p",[n._v("这里彦祖权限为 auth，位掩码为各个枚举值，通过与运算值判断是否为 true")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v('if (auth & roleA) {\n\n    NSLog(@"给彦祖一个面具");\n\n}\n\nif (auth & roleB) {\n\n    NSLog(@"给彦祖一把枪");\n\n}\n\nif (auth & roleC) {\n\n    NSLog(@"给彦祖一个成龙");\n\n}\n')])])]),o("p",[n._v("对比一下优势明显，一个整型代替数组，同时避免了数组遍历。")]),n._v(" "),o("p",[o("strong",[n._v("或运算：因为位掩码都是 1 后面跟若干个 0，进行或运算相当于把有 1 的位数都拼凑到一起，有 1 的即拥有对应位的权限。")])]),n._v(" "),o("p",[o("strong",[n._v("与运算：位掩码的位置有 1 且对应计算的值位置也是 1 结果才是 1，有再多的 1 如果与位掩码对应不上，结果只能是 0，boolean 为 false")])]),n._v(" "),o("h2",{attrs:{id:"javascript-搞个例子🌰"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#javascript-搞个例子🌰","aria-hidden":"true"}},[n._v("#")]),n._v(" JavaScript 搞个例子"),o("strong",[n._v("🌰")])]),n._v(" "),o("h3",{attrs:{id:"要求"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#要求","aria-hidden":"true"}},[n._v("#")]),n._v(" 要求")]),n._v(" "),o("ul",[o("li",[o("p",[n._v("有3个 button：btn1、btn2、btn3")])]),n._v(" "),o("li",[o("p",[n._v("有一个事件枚举: touchDown(鼠标按下)、touchUp(鼠标抬起)、doublieTouch(双击)")])]),n._v(" "),o("li",[o("p",[n._v("有3个埋点函数，分别负责：touchDownLog(鼠标按下)、touchUpLog(鼠标抬起)、doublieTouchLog(双击)")])]),n._v(" "),o("li",[o("p",[n._v("给 button 添加埋点，要求：")]),n._v(" "),o("ul",[o("li",[n._v("btn1 监听 touchDown 与 touchUp")]),n._v(" "),o("li",[n._v("btn2 监听 touchDown 与 doublieTouch")]),n._v(" "),o("li",[n._v("btn3 监听 touchDown 与 touchUp 与 doublieTouch")])])])]),n._v(" "),o("h3",{attrs:{id:"常规做法"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#常规做法","aria-hidden":"true"}},[n._v("#")]),n._v(" 常规做法")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("const touchDown = 'touchDown';\n\nconst touchUp = 'touchUp';\n\nconst doublieTouch = 'doublieTouch';\n\n\n\nfunction addEventListener(ele, eventTypes) {\n\n    eventTypes.forEach(eventType => {\n\n        ele.addEventListener(eventType, () => {\n\n            if (eventType === touchDown) {\n\n                ele.addEventListener('mousedown', log(touchDown));\n\n            }\n\n            if (eventType === touchUp) {\n\n                ele.addEventListener('mouseup', log(touchUp));\n\n            }\n\n            if (eventType === doublieTouch) {\n\n                ele.addEventListener('dblclick', log(doublieTouch));\n\n            }\n\n        });\n\n    });\n\n}\n\n\n\naddEventListener(btn1, [touchDown, touchUp]);\n\naddEventListener(btn2, [touchDown, doublieTouch]);\n\naddEventListener(btn3, [touchDown, touchUp, doublieTouch]);\n")])])]),o("h3",{attrs:{id:"位移枚举做法"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#位移枚举做法","aria-hidden":"true"}},[n._v("#")]),n._v(" 位移枚举做法")]),n._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[n._v("const touchDown = 1 << 0;\n\nconst touchUp = 1 << 1;\n\nconst doublieTouch = 1 << 2;\n\n\n\nfunction addEventListener(ele, eventType) {\n\n    if (eventType & touchDown) {\n\n        ele.addEventListener('mousedown', log(touchDown));\n\n    }\n\n    if (eventType & touchUp) {\n\n        ele.addEventListener('mouseup', log(touchUp));\n\n    }\n\n    if (eventType & doublieTouch) {\n\n        ele.addEventListener('dblclick', log(doublieTouch));\n\n    }\n\n}\n\n\n\naddEventListener(btn1, touchDown | touchUp);\n\naddEventListener(btn2, touchDown | doublieTouch);\n\naddEventListener(btn2, touchDown | touchUp | doublieTouch);\n")])])]),o("p",[n._v("同样的几行判断，少了一层数组和对数组的遍历")]),n._v(" "),o("p",[o("img",{attrs:{src:e(212),alt:""}})])])}],a=e(0),r=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},o,!1,null,null,null);t.default=r.exports}}]);