(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{187:function(t,e,n){t.exports=n.p+"assets/img/demo.d1611d18.png"},188:function(t,e,n){t.exports=n.p+"assets/img/1.fd4caab9.png"},189:function(t,e,n){t.exports=n.p+"assets/img/2.a5436329.png"},190:function(t,e,n){t.exports=n.p+"assets/img/3.241967f5.png"},191:function(t,e,n){t.exports=n.p+"assets/img/4.58d6706e.png"},192:function(t,e,n){t.exports=n.p+"assets/img/5.4355f168.png"},193:function(t,e,n){t.exports=n.p+"assets/img/6.1257bf6a.png"},194:function(t,e,n){t.exports=n.p+"assets/img/7.419579cf.png"},195:function(t,e,n){t.exports=n.p+"assets/img/8.e9fc7b1c.png"},196:function(t,e,n){t.exports=n.p+"assets/img/9.9c3a1ff5.png"},197:function(t,e,n){t.exports=n.p+"assets/img/10.0a048de2.png"},198:function(t,e,n){t.exports=n.p+"assets/img/11.84c09cbc.png"},199:function(t,e,n){t.exports=n.p+"assets/img/12.33275e98.png"},200:function(t,e,n){t.exports=n.p+"assets/img/13.7eeabb03.png"},201:function(t,e,n){t.exports=n.p+"assets/img/14.5116a6ab.png"},202:function(t,e,n){t.exports=n.p+"assets/img/15.7a6224b6.png"},203:function(t,e,n){t.exports=n.p+"assets/img/16.a093c6d7.png"},204:function(t,e,n){t.exports=n.p+"assets/img/17.0a2d6ca8.png"},245:function(t,e,n){"use strict";n.r(e);var s=[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"常见的跨端方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见的跨端方案","aria-hidden":"true"}},[this._v("#")]),this._v(" 常见的跨端方案")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"hybrid-webview-时代"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hybrid-webview-时代","aria-hidden":"true"}},[this._v("#")]),this._v(" hybrid - webview 时代")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"url-拦截"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#url-拦截","aria-hidden":"true"}},[this._v("#")]),this._v(" URL 拦截")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[this._v("location"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(".")]),this._v("href "),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[this._v("'alert://哈哈哈哈'")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-objective-c extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler {\n    NSString * urlStr = navigationAction.request.URL.absoluteString;\n    NSLog(@"发送跳转请求：%@",urlStr);\n    //自己定义的协议头\n    NSString *htmlHeadString = @"alert://";\n    NSString *decodedString=(__bridge_transfer NSString *)CFURLCreateStringByReplacingPercentEscapesUsingEncoding(NULL, (__bridge CFStringRef)[urlStr substringFromIndex: 8], CFSTR(""), CFStringConvertNSStringEncodingToEncoding(NSUTF8StringEncoding));\n    if([urlStr hasPrefix:htmlHeadString]){\n        UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@"通过截取URL调用OC" message:decodedString preferredStyle:UIAlertControllerStyleAlert];\n        [alertController addAction:([UIAlertAction actionWithTitle:@"哦哦" style:UIAlertActionStyleCancel handler:^(UIAlertAction * _Nonnull action) {}])];\n        [self presentViewController:alertController animated:YES completion:nil];\n        decisionHandler(WKNavigationActionPolicyCancel);\n    }else{\n        decisionHandler(WKNavigationActionPolicyAllow);\n    }\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"javascriptcore"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#javascriptcore","aria-hidden":"true"}},[this._v("#")]),this._v(" JavaScriptCore")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("JSContext 可以创建js的执行上下文或者通过 KVC 的方式取到"),e("code",[this._v("UIWebview")]),this._v("的js上下文(注意WKWebview不能取到)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-objective-c extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('//创建context\n    self.context = [_webView valueForKeyPath:@"documentView.webView.mainFrame.javaScriptContext"]; // wkwebview 里没有这玩意\n    //设置异常处理\n    self.context.exceptionHandler = ^(JSContext *context, JSValue *exception) {\n        [JSContext currentContext].exception = exception;\n        NSLog(@"exception:%@",exception);\n    };\n    //将obj添加到context中\n    self.context[@"OCObj"] = self;\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-objective-c extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("//定义一个JSExport protocol\n@protocol JSExportProtocol <JSExport>\n\n//用宏转换下，将JS函数名字指定为add；\nJSExportAs(add, - (NSInteger)add:(NSInteger)n1 with:(NSInteger)n2);\nJSExportAs(addByCallback, - (void)add:(NSInteger)n1 with:(NSInteger)n2 callback:(JSValue *)cb);\nJSExportAs(openWKWebView, - (void)openWKWebView:(id)param);\nJSExportAs(callThread, - (void)callThread:(id)param);\nJSExportAs(showHtml, - (void)showHtml:(NSString *)str);\n\n@end\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("\t  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callOCGetReturn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用 OC 方法，OCObj 是注入的全局变量")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sum "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" OCObj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Math"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("random")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" el "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'h1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerText "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`同步的结果: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("sum"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callOCWithBlock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            OCObj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addByCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Math"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("random")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" el "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'h1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerText "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`回调的结果: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("sum"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-objective-c extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('\t//  调用js的时候传参为一个数组，相当于 fn.apply(null, [xx])\n    [_context[@"changeColor"] callWithArguments:@[@"green", @"yellow", ^(JSValue *value) {\n        UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@"oc call js callback" message:value.toString preferredStyle:UIAlertControllerStyleAlert];\n        [alertController addAction:([UIAlertAction actionWithTitle:@"哦" style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) {\n        }])];\n        [self presentViewController:alertController animated:YES completion:nil];\n    }]];\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-objective-c extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("\t- (void)add:(NSInteger)a with:(NSInteger)b callback:(JSValue *)cb {\n\t\t//  延时 2 秒\n\t    dispatch_after(dispatch_time(DISPATCH_TIME_NOW,(int64_t)(2.0* NSEC_PER_SEC)),dispatch_get_main_queue(),^{\n\t        [cb callWithArguments:@[@(a + b)]];\n\t    });\n\t}\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在webview中，js的执行会阻塞页面的渲染，如果js执行时间过长就会导致页面假死。可以参考小程序，借助native的能力，将普通js另起线程创建 JSContext 执行，跟页面相关的操作如"),e("code",[this._v("setData")]),this._v("放到webview的线程里执行。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-objective-c extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('\t- (void)callThread:(id)param {\n    dispatch_queue_t queue = dispatch_queue_create("js",NULL);\n        dispatch_async(queue, ^{\n            NSString *jsPath = [[NSBundle mainBundle] pathForResource:@"fe-file/js/index.js" ofType:nil];\n            NSString *jsString = [[NSString alloc]initWithContentsOfFile:jsPath encoding:NSUTF8StringEncoding error:nil];\n            JSContext *jsContext = [[JSContext alloc] init];\n            jsContext[@"OCObj"] = self;\n            [jsContext evaluateScript:jsString];\n            \n    //        [jsContext[@"init"] callWithArguments:@[^(JSValue *value) {\n    //            NSString *js = [NSString stringWithFormat:@"document.write(\'%@\')", value.toString];\n    //            dispatch_async(dispatch_get_main_queue(), ^{\n    //                [self.context evaluateScript:js];\n    //            });\n    //        }]];\n        });\n}\n')])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("numberMillis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" now "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" exitTime "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" numberMillis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        now "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" exitTime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hahaha6666'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nOCObj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("showHtml")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hahahahaha'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"wkwebview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#wkwebview","aria-hidden":"true"}},[this._v("#")]),this._v(" WKWebview")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-objective-c extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("\t  //创建网页配置对象\n        WKWebViewConfiguration *config = [[WKWebViewConfiguration alloc] init];\n        \n        // 创建设置对象\n        WKPreferences *preference = [[WKPreferences alloc]init];\n        //最小字体大小 当将javaScriptEnabled属性设置为NO时，可以看到明显的效果\n        preference.minimumFontSize = 0;\n        //设置是否支持javaScript 默认是支持的\n        preference.javaScriptEnabled = YES;\n        // 在iOS上默认为NO，表示是否允许不经过用户交互由javaScript自动打开窗口\n        preference.javaScriptCanOpenWindowsAutomatically = YES;\n        config.preferences = preference;\n\n        // 是使用h5的视频播放器在线播放, 还是使用原生播放器全屏播放\n        config.allowsInlineMediaPlayback = YES;\n        //设置视频是否需要用户手动播放  设置为NO则会允许自动播放\n//        config.requiresUserActionForMediaPlayback = YES;        //设置请求的User-Agent\n        config.applicationNameForUserAgent = @\"WhosYourDaddy\";\n        \n        // WKUserContentController对象负责注册JS方法，设置处理接收JS方法的代理，代理WKScriptMessageHandler里回调\n        // WKWebView不支持JavaScriptCore的方式, 但提供messagehandler的方式为JavaScript与OC通信\n        WKUserContentController * wkUController = [[WKUserContentController alloc] init];\n        //注册一个name为callOC的js方法 设置处理接收JS方法的对象\n        [wkUController addScriptMessageHandler:self name:@\"callOC\"];\n        [wkUController addScriptMessageHandler:self name:@\"insertLayer\"];\n\n        config.userContentController = wkUController;\n        // JavaScript注入\n        NSString *jsStr = @\"window.onload=function(){const el=document.createElement('div');el.innerText='我是oc插入的 go';el.style.position='fixed';el.style.top=0;el.style.left=0;el.style.backgroundColor='blue';el.style.width='100vw';el.onclick=function(){location.href='https://calcbit.com';};document.body.appendChild(el)}\";\n        WKUserScript *wkUScript = [[WKUserScript alloc] initWithSource:jsStr injectionTime:WKUserScriptInjectionTimeAtDocumentEnd forMainFrameOnly:YES];\n        [config.userContentController addUserScript:wkUScript];\n        \n        _webView = [[WKWebView alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT) configuration:config];\n        _webView.UIDelegate = self;\n        _webView.navigationDelegate = self;\n        _webView.allowsBackForwardNavigationGestures = YES; // 是否允许手势左滑返回\n        \n        if ([[NSPredicate predicateWithFormat:@\"SELF MATCHES %@\",  @\"http(s)?://.+\"] evaluateWithObject:_path]) {\n            NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:_path]];\n            [_webView loadRequest:request];\n        } else {\n            NSString *htmlString = [[NSString alloc]initWithContentsOfFile:_path encoding:NSUTF8StringEncoding error:nil];\n            [_webView loadHTMLString:htmlString baseURL:[NSURL fileURLWithPath:[[NSBundle mainBundle] bundlePath]]];\n        }\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-jsvascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("\twindow.webkit.messageHandlers.callOC.postMessage({\n\t\tmsg: '我来自js'\n\t});\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-objective-c extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('\t//  WKWebView收到ScriptMessage时回调此方法\n\t- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message {\n\t    NSDictionary *parameter = message.body;\n\t    if([message.name isEqualToString:@"callOC"]){\n\t        UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@"js call oc" message:parameter[@"msg"] preferredStyle:UIAlertControllerStyleAlert];\n\t        [alertController addAction:([UIAlertAction actionWithTitle:@"哦" style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) {\n\t        }])];\n\t        [self presentViewController:alertController animated:YES completion:nil];\n\t    } else if([message.name isEqualToString:@"insertLayer"]){\n\t        [self findChildView:[_webView subviews] tagId:parameter[@"tagId"] src:parameter[@"src"]];\n\t    }\n\t    \n\t}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"同层渲染"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#同层渲染","aria-hidden":"true"}},[this._v("#")]),this._v(" 同层渲染")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-jsvascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('<!DOCTYPE HTML>\n<html>\n<meta charset="utf-8">\n<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">\n<title>wk hybird</title>\n\n<head>\n    <style>\n        body {\n            height: 100%;\n            background-color: pink;\n        }\n\n        .wrapper {\n            width: 100%;\n            height: 301px;\n            overflow: scroll;\n            -webkit-overflow-scrolling: touch;\n            background-color: blue;\n            position: absolute;\n            bottom: 0;\n            left: 0;\n        }\n\n        .content {\n            height: 302px;\n            background: green\n        }\n    </style>\n    <script>\n        var bottom = 0;\n\n        function changeColor(color) {\n            document.body.style.color = color;\n            return 666;\n        }\n\n        function callOCBySchema() {\n            location.href = \'alert://唤起来哈哈哈哈\'\n        }\n\n        function callOC() {\n            window.webkit.messageHandlers.callOC.postMessage({\n                msg: \'我来自js\'\n            });\n        }\n\n        function insertLayer() {\n            window.webkit.messageHandlers.insertLayer.postMessage({});\n        }\n\n        function up() {\n            bottom += 50;\n            document.querySelector(\'.wrapper\').style = `bottom: ${bottom}px`;\n        }\n\n        function down() {\n            bottom -= 50;\n            document.querySelector(\'.wrapper\').style = `bottom: ${bottom}px`;\n        }\n\n        class UIImage extends HTMLElement {\n            static get observedAttributes() {\n                return [\'src\'];\n            }\n            connectedCallback() {\n                // 不延时OC那边就找不到 WKChildScrollView 估计是没渲染好\n                setTimeout(() => {\n                    window.webkit.messageHandlers.insertLayer.postMessage({\n                        tagId: 301,\n                        src: this.getAttribute(\'src\')\n                    });\n                }, 1000);\n            }\n        }\n        window.customElements.define(\'ui-image\', UIImage);\n    <\/script>\n</head>\n\n<body>\n    <section style="margin-top: 25px">\n        <button onclick="callOCBySchema()">url 跳转唤起 native alert</button>\n        <button onclick="callOC()">调用 OC</button>\n    </section>\n    <section>\n        <button onclick="up()">上移</button>\n        <button onclick="down()">下移</button>\n    </section>\n    <div class="wrapper">\n        <div class="content"></div>\n        <ui-image\n            src="https://calcbit.com/resource/doudou/doudou.jpeg">\n        </ui-image>\n    </div>\n</body>\n\n</html>\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-objective-c extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('- (void)findChildView:(NSArray *)list tagId: (NSNumber *)tagId src:(NSString *)src {\n    for (int i = 0; i < [list count]; i++) {\n        UIView *obj = list[i];\n        NSLog(@"%@", [obj class]);\n        if ([[NSString stringWithFormat:@"%@", [obj class]] isEqualToString:@"WKChildScrollView"] && tagId.doubleValue == obj.bounds.size.height) {\n            NSData *imgData = [NSData dataWithContentsOfURL:[NSURL URLWithString:src]];\n            UIImage *image = [UIImage imageWithData:imgData];\n            UIImageView *imageView = [[UIImageView alloc] initWithImage:image];\n            [obj addSubview:imageView];\n        } else if ([obj isKindOfClass:[UIView class]]) {\n            [self findChildView: [obj subviews] tagId:tagId src:src];\n        }\n    }\n    \n}\n\n#pragma mark - WKScriptMessageHandler\n// WKWebView收到ScriptMessage时回调此方法\n- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message {\n    NSDictionary *parameter = message.body;\n    if([message.name isEqualToString:@"callOC"]){\n        UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@"js call oc" message:parameter[@"msg"] preferredStyle:UIAlertControllerStyleAlert];\n        [alertController addAction:([UIAlertAction actionWithTitle:@"哦" style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) {\n        }])];\n        [self presentViewController:alertController animated:YES completion:nil];\n    } else if([message.name isEqualToString:@"insertLayer"]){\n        [self findChildView:[_webView subviews] tagId:parameter[@"tagId"] src:parameter[@"src"]];\n    }\n    \n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(187),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"react-native-泛-webview-时代"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#react-native-泛-webview-时代","aria-hidden":"true"}},[this._v("#")]),this._v(" React Native - 泛 webview 时代")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(188),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"初始化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初始化","aria-hidden":"true"}},[this._v("#")]),this._v(" 初始化")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(189),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(190),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"加载-javascript-代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#加载-javascript-代码","aria-hidden":"true"}},[this._v("#")]),this._v(" 加载 JavaScript 代码")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"初始化模块信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初始化模块信息","aria-hidden":"true"}},[this._v("#")]),this._v(" 初始化模块信息")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在 initModulesWithDispatchGroup: 中实现，找到所有需要暴露给 js 的类。需要暴露给 js 的类需要执行 RCT_EXPORT_MODULE 宏，暴露给 js 的属性需要执行 RCT_EXPORT_VIEW_PROPERTY，暴露的方法需要执行 RCT_EXPORT_METHOD。我们自己拓展原生模块的时候，也要执行这几个宏。\n"),e("img",{attrs:{src:n(191),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("通过RCTModuleClasses 拿到所有暴露给 JavaScript 的类，遍历生成 RCTModuleData。最后的模块表相当于 "),e("code",[this._v("Array<RCTModuleData>")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("所以，Objective-C 管理模块表的逻辑是：Bridge 持有一个数组，数组中保存了所有的模块的 RCTModuleData 对象。只要给定 ModuleId 和 MethodId 就可以唯一确定要调用的方法\n"),e("img",{attrs:{src:n(192),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"初始化js-执行对象-rctjscexecutor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初始化js-执行对象-rctjscexecutor","aria-hidden":"true"}},[this._v("#")]),this._v(" 初始化js 执行对象 RCTJSCExecutor")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("注册一堆 block 到js，js会调用这些回调，注意这里的 block 不是oc主动执行的，而是 js 触发的。比如 nativeRequireModuleConfig，js 在加载模块的时候调用的 loadModule 函数里里会触发 nativeRequireModuleConfig，js 触发调用信息时用到的 nativeFlushQueueImmediate，这里的 MIN_TIME_BETWEEN_FLUSHES_MS 下面再讲\n"),e("img",{attrs:{src:n(193),alt:""}}),this._v(" "),e("img",{attrs:{src:n(194),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"生成模块表并注入-js"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成模块表并注入-js","aria-hidden":"true"}},[this._v("#")]),this._v(" 生成模块表并注入 js")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在初始化模块信息的时候OC知道了有哪些模块表需要暴露给js，但是 js 还不知道这些模块表。所以这一步就是将模块表注入到js里，赋值给了一个全局变量 "),e("code",[this._v("__fbBatchedBridgeConfig")]),this._v("，在 js 里获取这个变量并遍历模块信息\n"),e("img",{attrs:{src:n(195),alt:""}}),this._v(" "),e("img",{attrs:{src:n(196),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"执行-js-代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行-js-代码","aria-hidden":"true"}},[this._v("#")]),this._v(" 执行 js 代码")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"运行时调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行时调用","aria-hidden":"true"}},[this._v("#")]),this._v(" 运行时调用")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"oc-调用-js"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#oc-调用-js","aria-hidden":"true"}},[this._v("#")]),this._v(" oc 调用 js")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("前面介绍 JSContext 的讲过，oc 可以直接调用全部的函数，但是在 RN 里并没有直接调用具体的函数，而是通过中转函数 callFunctionReturnFlushedQueue 来传递模块，函数，和参数的。\n"),e("img",{attrs:{src:n(197),alt:""}}),this._v(" "),e("img",{attrs:{src:n(198),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"js-调用-oc"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js-调用-oc","aria-hidden":"true"}},[this._v("#")]),this._v(" js 调用 oc")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(199),alt:""}}),this._v(" "),e("img",{attrs:{src:n(200),alt:""}}),this._v(" "),e("img",{attrs:{src:n(201),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("但是有时候由于卡顿等种种原因，OC 不一定能及时的来队列取消息，所以用到了上面步奏3提到的常量"),e("code",[this._v("MIN_TIME_BETWEEN_FLUSHES_MS")]),this._v("，查看js代码可以看到，这个值为 5ms，也就是说，超过 5ms js 发现 oc 还没取走消息，就会强制触发 nativeFlushQueueImmediate。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(202),alt:""}}),this._v(" "),e("img",{attrs:{src:n(203),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:n(204),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"优缺点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优缺点","aria-hidden":"true"}},[this._v("#")]),this._v(" 优缺点")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"优点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优点","aria-hidden":"true"}},[this._v("#")]),this._v(" 优点")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("复用了 React 的思想，有利于前端开发者涉足移动端")]),this._v(" "),e("li",[this._v("能够动态替换 js boundle 实现增量热更新")]),this._v(" "),e("li",[this._v("相比于原生平台，一套代码开发速度更快。相比于 Hybrid 框架，原生控件性能更好")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"缺点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#缺点","aria-hidden":"true"}},[this._v("#")]),this._v(" 缺点")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[t._v("RN 有一定的学习成本，Hybrid 对于前端几乎没有学习成本，并且 css 能力强于StyleSheet太多")]),t._v(" "),n("li",[t._v("做不到真正的一次编写随处运行，很多组件区分 iOS与安卓平台，开发者依然需要通过 "),n("code",[t._v("Platform.OS")]),t._v(" 判断平台进行差异化处理，即使是同一个组件，在iOS与安卓的表现形式也不一样")]),t._v(" "),n("li",[t._v("由"),n("code",[t._v("MIN_TIME_BETWEEN_FLUSHES_MS")]),t._v("可以发现，OC 与 js 通信存在开销，性能比不上纯原生。比如 ListView，rn 先是计算 Virtual Dom，再把计算结果推进 MessageQueue 队列，再等 oc 来取，再通过yoga布局，再在主线程进行渲染。而原生的 UITableView 滚动的时候是在主线程同步渲染列表，并且通过 dequeueReusableCellWithIdentifier 可以高效的复用 cell")]),t._v(" "),n("li",[t._v("渲染白屏时间长，不像纯原生渲染的快，boundle.js 里大部分都是基础代码，真正的业务代码占少部分。携程的做法是拆开基础 bundle 与业务 bundle，事先准备好加载好基础bundle的RCTRootView，使用的时候只需要加载业务bundle，这也是因为它是原生集成 RN，而不是整个app都是RN。再加载 native 的时候就可以准备好 RCTRootView，并且业务bundle特别多，基础bundle一份就够了。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"flutter-自绘引擎时代"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flutter-自绘引擎时代","aria-hidden":"true"}},[this._v("#")]),this._v(" Flutter - 自绘引擎时代")])}],a=n(0),r=Object(a.a)({},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/wayshon/jsbridge-demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("demo 地址"),n("OutboundLink")],1)]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),n("p",[t._v("webview 能够执行js，监听url的跳转，加载，失败/成功，返回等 delegate。")]),t._v(" "),n("p",[t._v("通过约束 url，比如 schema，js 需要唤起OC的时候跳转指定的约束的 url，OC 拦截 url 判断是允许跳转还是自定义操作")]),t._v(" "),t._m(3),t._m(4),t._m(5),t._v(" "),t._m(6),t._v(" "),n("p",[t._v("获取到上下文对象 JSContext 后，可以把 OC 的对象注入到 js，js 在上下文中可以取到这个注入的对象")]),t._v(" "),t._m(7),n("p",[t._v("被注入的OC对象需要定义 JSExport 协议，并实现，js 能够调用OC对象的定义在 JSExport 里的方法，注意OC的消息与js的方法结构不一样，需要用 JSExportAs 转换")]),t._v(" "),t._m(8),t._m(9),n("p",[t._v("JSContext 可以执行一段js，可以带上参数和获取返回值，并且参数可以传 block，这就可以使 js 里异步执行传递的 block")]),t._v(" "),t._m(10),n("p",[t._v("JSValue：表示的就是在 JSContext 中的 JS 变量 OC端的引用。js 调用 oc 可以直接获取到返回值，也可以传函数参数，通过JSValue获取到，在适当的时候异步执行，实现了异步回调")]),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._m(14),t._m(15),t._v(" "),n("p",[t._v("WKWebview 不能通过 KVC 获取到 JSContext，但是提供了更为简单的 WKScriptMessageHandler 协议进行 js 与 OC 的通信")]),t._v(" "),n("p",[t._v("WKUserScript 用于 js 注入")]),t._v(" "),n("p",[t._v("WKUserContentController 用于注册OC与js通信的消息名")]),t._v(" "),t._m(16),n("p",[t._v("WKScriptMessageHandler 的 delegate 接收 js 发过来的消息，消息名是在WKUserContentController时候注册，可以获取到js传递过来的参数，注意不能传函数，这与JSValue不同")]),t._v(" "),t._m(17),t._m(18),n("p",[t._v("WKWebview 可以通过evaluateJavaScript执行js，注意这里也与JSContext 的 callWithArguments 不同，不能传 block")]),t._v(" "),t._m(19),t._v(" "),n("p",[t._v("以前写hybrid页面，对于一些图片和视频，要么把native层盖在webview上，要么就是在webview上打孔，微信小程序出了个同层渲染，将native控件挂载到WKWebview的子view里，从而可以使用样式(部分)控制native控件。具体缘由请参考微信的文档"),n("a",{attrs:{href:"https://developers.weixin.qq.com/community/develop/article/doc/000c4e433707c072c1793e56f5c813",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序同层渲染原理剖析"),n("OutboundLink")],1),t._v("，下面上代码")]),t._v(" "),t._m(20),t._m(21),n("p",[t._v("利用 Custom Elements 自定义组件，在 connectedCallback 里通知 oc 创建控件，由于WKChildScrollView 里没法获得 dom 的信息(至少我没发现，如果可以求指点)但是可以获取到WKChildScrollView的高，这里使用dom 的 height 作为id来与native确定具体在哪个 WKChildScrollView 里挂载控件。")]),t._v(" "),n("p",[t._v("注意: div 不仅要设置scroll，还要有高度高于自身的子元素，使自己滚起来才会有 WKChildScrollView")]),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),n("p",[t._v("一次学习，随处运行。也就是说，React Native 是存在学习成本。")]),t._v(" "),t._m(24),t._v(" "),n("p",[t._v("React Native 与 Hybrid 完全没有关系，RN 里 JavaScript 负责处理数据与逻辑，产出结果。它只不过是以 JavaScript 的形式告诉 Objective-C 该执行什么代码，渲染什么UI。")]),t._v(" "),n("p",[t._v("C 系列的语言，需要经过编译，链接等操作后，产出二进制文件，而 js 是一种脚本语言，它不会经过编译、链接等操作，而是在运行时 才动态的进行词法、语法分析，生成抽象语法树(AST)和字节码，然后由解释器负责执行或者使用 JIT 将字节码转化为机器码再执行。整个流程由 JavaScript 引擎负责完成。(具体见"),n("a",{attrs:{href:"https://github.com/wayshon/review-2019/blob/master/file/v8%E5%BC%95%E6%93%8E.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("浅析v8引擎"),n("OutboundLink")],1),t._v(")")]),t._v(" "),n("p",[t._v("iOS 提供的 JavaScriptCore 可以创建js上下文执行一段js(上面讲到到过)，在安卓上用的webkit.org开源的jsc.co，两者差不多的玩意，为什么安卓不用 V8，据说是为了 jsc 层api统一。安卓也可以自己换成 V8，但是 iOS 不允许用自己的JS Engine。")]),t._v(" "),t._m(25),t._v(" "),n("p",[t._v("使用 RN 脚手架创建的项目在AppDelegate里创建了 RCTBridge，RCTRootView，并把 RCTRootView 挂载的 Controller 作为 window的根视图。自定义集成的项目随意，只需要RCTBridge，RCTRootView，不一定非要作为根Controller。")]),t._v(" "),n("p",[t._v("RN 先创建了一个 Bridge，这是 OC 与 js 沟通的桥梁，创建的时候把AppDelegate作为代理传入，在核心方法setUp中创建BatchedBridge的时候会调用代理的sourceURLForBridge获得 js 文件。")]),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),n("p",[t._v("初始化方法的核心是 setUp 方法，而 setUp 方法的主要任务则是创建 BatchedBridge。")]),t._v(" "),n("p",[t._v("BatchedBridge 的作用是批量读取 JavaScript 对 Objective-C 的方法调用，同时它内部持有一个 JavaScriptExecutor，用来执行 JavaScript 代码。")]),t._v(" "),n("p",[t._v("创建 BatchedBridge 的关键是 start 方法，分为以下五个步骤:")]),t._v(" "),t._m(28),t._v(" "),n("p",[t._v("加载打包后的js代码，这里的js已经是jsx转化后的原生js")]),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),n("p",[t._v("这一步就是真正开始执行第一步加载的 js 代码，第三步的 block 也会执行，运行环境准备完成")]),t._v(" "),t._m(38),t._v(" "),n("p",[t._v("在 RN 中，oc 和 js 的交互都是通过传递 ModuleId、MethodId 和 Arguments 进行的")]),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),n("p",[t._v("在之前的 JSContext 介绍，可以将oc对象实现JSExport协议注入到js的上下文给js直接调用。")]),t._v(" "),n("p",[t._v("但是在RN里js一般不会直接调用oc，而是将所触发ModuleId、MethodId 和 Arguments 存放到 MessageQueue 中，等 OC 在 runloop 中取这个队列并执行。")]),t._v(" "),n("p",[t._v("OC 端注册 CADisplayLink 回调，并将 CADisplayLink 添加到 runloop，CADisplayLink 会与屏幕刷新频率相同的速率执行回调，在这个回调里 OC 可以取 MessageQueue 中的任务交给 Yoga 进行布局，然后再调用原生控件渲染UI。Yoga 是一个跨平台库，可以使用flex的方式进行布局")]),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),n("p",[n("router-link",{attrs:{to:"/2020/怎么开发一个flutter-ios插件.html"}},[t._v("怎么开发一个 flutter ios 插件")]),t._v("\n持续学习中。。。")],1)])},s,!1,null,null,null);e.default=r.exports}}]);